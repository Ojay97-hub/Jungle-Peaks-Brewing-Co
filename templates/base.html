{% load static imgix_tags %}

<!doctype html>
<html lang="en">
<head>

    {% block meta %}
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- keywords -->
        <meta name="description" content="Explore Jungle Peaks Brewing's diverse selection of craft beers, including IPAs, lagers, stouts, and more. Discover our unique flavors and quality brewing process.">
        <meta name="keywords" content="Amazon craft brewery, Jungle Peaks Brewing, Amazon brewery tours, 
        Amazon beer tastings, beer education, beer experiences, taproom, IPA beer, Lager beer, 
        Stout beer, Wheat Beer, Pale Ale, Sour beer, Seasonal Ale, Light Beer, beer delivery, beer store, 
        buy beer online, craft beer gifts, best craft beer in Amazon">
        <meta name="author" content="Jungle Peaks Brewing">

        <meta property="og:title" content="Jungle Peaks Brewing">
        <meta property="og:description" content="Explore Jungle Peaks Brewing's diverse selection of craft beers, including IPAs, lagers, stouts, and more.">
        <meta property="og:image" content="{% imgix_url 'images/og-image.jpg' %}">
        <meta property="og:url" content="https://jungle-peaks-brewing-29d2cf7236c2.herokuapp.com/">
        <meta property="og:type" content="website">
    {% endblock %}

    {% block extra_meta %}
    {% endblock %}

    {% block corecss %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Albert+Sans:wght@100..900&display=swap">
        <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% endblock %}

    {% block extra_css %}
    {% endblock %}

    {% block corejs %}
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    {% endblock %}

    {% block extra_js %}
    {% endblock %}

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png'  %}">

    <title>Jungle Peaks Brewing {% block extra_title %}{% endblock %}</title>
    </head>

  <body>
<!-- Header -->
<header class="modern-header">
    <!-- Top promotional banner -->
    <div class="promo-banner">
        <div class="container">
            <div class="promo-content">
                <span class="promo-text">
                    <i data-lucide="truck" class="promo-icon"></i>
                    Free delivery on orders over £{{ free_delivery_threshold }}!
                    <span class="countdown-timer" id="countdown-desktop"></span>
                </span>
                <button class="promo-close" aria-label="Close banner">
                    <i data-lucide="x"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main navigation -->
    <nav class="main-navbar">
        <div class="container">
            <div class="navbar-content">
                <!-- Logo -->
                <a href="{% url 'home' %}" class="brand-logo" aria-label="Go to Jungle Peaks Brewing homepage">
                    <div class="logo-icon">
                        <i data-lucide="mountain"></i>
                    </div>
                    <span class="logo-text">Jungle Peaks</span>
                </a>

                <!-- Search Bar (Desktop) -->
                {% if request.resolver_match.url_name == 'products' or request.resolver_match.url_name == 'product_detail' %}
                <div class="search-container d-none d-lg-flex">
                    <form method="GET" action="{% url 'products' %}" class="search-form">
                        <div class="search-input-group">
                            <i data-lucide="search" class="search-icon"></i>
                            <input
                                type="search"
                                name="q"
                                value="{{ request.GET.q }}"
                                placeholder="Search for craft beers, merchandise..."
                                aria-label="Search for products"
                                class="search-input"
                            >
                            <button type="submit" class="search-btn" aria-label="Search">
                                <i data-lucide="arrow-right"></i>
                            </button>
                        </div>
                    </form>
                </div>
                {% endif %}

                <!-- Navigation Links (Desktop) -->
                <div class="nav-links d-none d-lg-flex">
                    <a href="{% url 'home' %}" class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                        <i data-lucide="home"></i>
                        Home
                    </a>
                    <a href="{% url 'products' %}" class="nav-link {% if request.resolver_match.url_name == 'products' or request.resolver_match.url_name == 'product_detail' %}active{% endif %}">
                        <i data-lucide="shopping-bag"></i>
                        Shop
                    </a>
                    <a href="{% url 'taproom' %}" class="nav-link {% if request.resolver_match.url_name == 'taproom' %}active{% endif %}">
                        <i data-lucide="coffee"></i>
                        Taproom
                    </a>
                    <a href="{% url 'tours' %}" class="nav-link {% if request.resolver_match.url_name == 'tours' %}active{% endif %}">
                        <i data-lucide="map-pin"></i>
                        Tours
                    </a>
                    <a href="{% url 'contact:contact' %}" class="nav-link {% if request.resolver_match.url_name == 'contact' %}active{% endif %}">
                        <i data-lucide="mail"></i>
                        Contact
                    </a>
                </div>

                <!-- Action buttons -->
                <div class="navbar-actions">
                    <!-- Cart -->
                    <a href="{% url 'view_bag' %}" class="action-btn cart-btn" aria-label="View shopping cart">
                        <div class="btn-icon">
                            <i data-lucide="shopping-cart"></i>
                            {% if bag_items %}
                                <span class="cart-badge">{{ bag_items|length }}</span>
                            {% endif %}
                        </div>
                        <div class="btn-content d-none d-md-block">
                            <span class="btn-label">Cart</span>
                            <span class="btn-value">
                                {% if grand_total %}
                                    £{{ grand_total|floatformat:2 }}
                                {% else %}
                                    £0.00
                                {% endif %}
                            </span>
                        </div>
                    </a>

                    <!-- User Account -->
                    <div class="dropdown">
                        <button
                            class="action-btn user-btn"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            aria-label="User account menu"
                        >
                            <div class="btn-icon">
                                <i data-lucide="user"></i>
                            </div>
                            <div class="btn-content d-none d-md-block">
                                <span class="btn-label">
                                    {% if request.user.is_authenticated %}
                                        {{ request.user.username|title }}
                                    {% else %}
                                        Account
                                    {% endif %}
                                </span>
                                <span class="btn-value">
                                    {% if request.user.is_authenticated %}
                                        My Profile
                                    {% else %}
                                        Sign In
                                    {% endif %}
                                </span>
                            </div>
                            <i data-lucide="chevron-down" class="dropdown-arrow d-none d-md-block"></i>
                        </button>

                        <ul class="dropdown-menu">
                            {% if request.user.is_authenticated %}
                                {% if request.user.is_superuser %}
                                    <li>
                                        <a href="{% url 'add_product' %}" class="dropdown-item">
                                            <i data-lucide="settings"></i>
                                            Product Management
                                        </a>
                                    </li>
                                {% endif %}
                                <li>
                                    <a href="{% url 'profile' %}" class="dropdown-item">
                                        <i data-lucide="user-circle"></i>
                                        My Profile
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a href="{% url 'account_logout' %}" class="dropdown-item">
                                        <i data-lucide="log-out"></i>
                                        Sign Out
                                    </a>
                                </li>
                            {% else %}
                                <li>
                                    <a href="{% url 'account_login' %}" class="dropdown-item">
                                        <i data-lucide="log-in"></i>
                                        Sign In
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url 'account_signup' %}" class="dropdown-item">
                                        <i data-lucide="user-plus"></i>
                                        Create Account
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </div>

                    <!-- Mobile menu toggle -->
                    <button
                        class="mobile-menu-btn d-lg-none"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#mobile-nav"
                        aria-controls="mobile-nav"
                        aria-expanded="false"
                        aria-label="Toggle navigation menu"
                    >
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                </div>
            </div>

            <!-- Mobile Navigation -->
            <div class="collapse mobile-nav-collapse" id="mobile-nav">
                <div class="mobile-nav-content">
                    <!-- Mobile Search (if on products page) -->
                    {% if request.resolver_match.url_name == 'products' or request.resolver_match.url_name == 'product_detail' %}
                    <div class="mobile-search">
                        <form method="GET" action="{% url 'products' %}">
                            <div class="search-input-group">
                                <i data-lucide="search" class="search-icon"></i>
                                <input
                                    type="search"
                                    name="q"
                                    value="{{ request.GET.q }}"
                                    placeholder="Search products..."
                                    aria-label="Search for products"
                                    class="search-input"
                                >
                                <button type="submit" class="search-btn">
                                    <i data-lucide="arrow-right"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                    {% endif %}

                    <!-- Mobile Navigation Links -->
                    <div class="mobile-nav-links">
                        <a href="{% url 'home' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                            <i data-lucide="home"></i>
                            <span>Home</span>
                        </a>
                        <a href="{% url 'products' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'products' or request.resolver_match.url_name == 'product_detail' %}active{% endif %}">
                            <i data-lucide="shopping-bag"></i>
                            <span>Shop</span>
                        </a>
                        <a href="{% url 'taproom' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'taproom' %}active{% endif %}">
                            <i data-lucide="coffee"></i>
                            <span>Taproom</span>
                        </a>
                        <a href="{% url 'tours' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'tours' %}active{% endif %}">
                            <i data-lucide="map-pin"></i>
                            <span>Tours</span>
                        </a>
                        <a href="{% url 'contact:contact' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'contact' %}active{% endif %}">
                            <i data-lucide="mail"></i>
                            <span>Contact</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

    <main>
        {% if messages %}
        <div class="message-container" aria-live="polite" aria-atomic="true">
            {% for message in messages %}
            {% with message.level as level %}
            {% if level == 40 %}
            {% include 'includes/toasts/toast_error.html' %}
            {% elif level == 30 %}
            {% include 'includes/toasts/toast_warning.html' %}
            {% elif level == 25 %}
            {% include 'includes/toasts/toast_success.html' %}
            {% else %}
            {% include 'includes/toasts/toast_info.html' %}
            {% endif %}
            {% endwith %}
            {% endfor %}
        </div>
        {% endif %}

        {% block breadcrumbs %}{% endblock %}

        {% block page_header %}
        {% endblock %}

        {% block content %}
        {% endblock %}
    </main>

<!-- FOOTER SECTION -->
<footer class="footer py-5">
    <div class="container">
            <!-- Main Footer Content -->
            <div class="row justify-content-between">
              <!-- Newsletter Section -->
              <div class="col-md-4 mb-4">
                <h3 class="text-start fw-bold">Newsletter</h3>
                <p class="text-start">Sign up for our newsletter to stay updated on our latest brews and events.</p>
                <form action="{% url 'newsletter_signup' %}" method="POST" class="d-flex flex-column flex-sm-row gap-2 align-items-stretch" id="newsletter-form">
                    {% csrf_token %}
                    <input
                        type="email"
                        name="email"
                        id="email"
                        class="form-control"
                        placeholder="Enter your email"
                        required
                        aria-label="Enter your email to subscribe">
                  <button type="submit" class="btn btn-accent" aria-label="Subscribe to newsletter">
                        Subscribe
                    </button>
                </form>
            </div>
  
            <!-- Explore and Quick Links Section -->
              <div class="col-md-4">
                <div class="row">
                  <!-- Explore Section -->
                  <div class="col-6">
                    <h3 class="text-start fw-bold">Explore</h3>
                    <ul class="list-unstyled text-start">
                        <li><a href="{% url 'home' %}" class="text-white text-decoration-none" aria-label="Go to Home">Home</a></li>
                        <li><a href="{% url 'products' %}" class="text-white text-decoration-none" aria-label="Go to Shop">Shop</a></li>
                        <li><a href="{% url 'taproom' %}" class="text-white text-decoration-none" aria-label="Go to Taproom">Taproom</a></li>
                        <li><a href="{% url 'tours' %}" class="text-white text-decoration-none" aria-label="Go to Tours">Tours</a></li>
                    </ul>
                </div>
        
                  <!-- Quick Links Section -->
                  <div class="col-6">
                    <h3 class="text-start fw-bold">Quick Links</h3>
                    <ul class="list-unstyled text-start">
                        <li><a href="https://www.termsfeed.com/live/1c4b584c-86ce-43c1-9a8e-09e3d3f9f315" class="text-white text-decoration-none" aria-label="View Privacy Policy">Privacy Policy</a></li>
                        <li><a href="{% url 'contact:contact' %}" class="text-white text-decoration-none" aria-label="Contact Us">Contact Us</a></li>
                        <li><a href="{% url 'home' %}#about" class="text-white text-decoration-none" aria-label="Learn more About Us">About Us</a></li>
                        <li><a href="{% url 'contact:contact' %}#faqs" class="text-white text-decoration-none" aria-label="View FAQs">FAQs</a></li>
                    </ul>
                </div>
              </div>
            </div>
  
            <!-- Follow Us Section -->
            <div class="col-md-3 text-center">
                <h3 class="fw-bold">Follow Us</h3>
                <div class="d-flex justify-content-center gap-3 mt-3">
                    <a href="https://www.facebook.com/profile.php?id=61573268283619" target="_blank" rel="noopener" class="text-decoration-none" aria-label="Follow us on Facebook">
                        <i data-lucide="facebook"></i>
                    </a>
                    <a href="https://twitter.com" target="_blank"  rel="noopener" class="text-decoration-none" aria-label="Follow us on Twitter">
                        <i data-lucide="twitter"></i>
                    </a>
                    <a href="https://instagram.com" target="_blank" rel="noopener" class="text-decoration-none" aria-label="Follow us on Instagram">
                        <i data-lucide="instagram"></i>
                    </a>
                </div>
            </div>
        </div>
  
        <!-- Divider and Footer Bottom -->
        <hr class="text-white opacity-25 mt-4">
        <div class="text-center mt-3">
            <p class="mb-1">Jungle Peaks Brewing, 123 Craft Lane, Beer Town, BT 78910</p>
            <p>
                <a href="https://www.google.com/maps?q=AM-070%20-%20Iranduba,%20Manaus%20-%20AM,%2069405-000,%20Brazil"  
                    target="_blank" 
                    class="text-white text-decoration-none" 
                    aria-label="View Jungle Peaks Brewing location on Google Maps">
                    View in Google Maps
                </a>
            </p>
        </div>
    </div>
  </footer>
  

    <!-- Newsletter Interest Pop-up -->
    <div id="newsletter-popup" class="modal-overlay">
      <div class="modal-card">
          <h2 class="text-center fw-bold">🍻 Customise Your Subscription</h2>
          <p class="text-center">Select what you're most interested in:</p>

          <form id="interest-form">
              <input type="hidden" id="subscriber_id"> <!-- Store the subscriber ID -->

              <div class="checkbox-container">
                  <label class="checkbox-label">
                      <input type="checkbox" name="interest" value="beer"> 🍺 I'm a Beer Guy
                  </label>
                  <label class="checkbox-label">
                      <input type="checkbox" name="interest" value="food"> 🍔 I'm a Foodie
                  </label>
                  <label class="checkbox-label">
                      <input type="checkbox" name="interest" value="merch"> 👕 Give Me Your Merch
                  </label>
              </div>

              <div class="text-center mt-3">
                  <button type="submit" class="btn btn-success">Save Preferences</button>
                  <button type="button" id="close-popup" class="btn btn-secondary">Close</button>
              </div>
          </form>
      </div>
    </div>


{% block postloadjs %}
<script src="{% static 'js/newsletter.js' %}"></script>

<!-- Initialize Lucide Icons -->
<script>
    lucide.createIcons();
</script>

<!-- Stripe -->        
{% if request.resolver_match.url_name == 'checkout' %}
<script src="https://js.stripe.com/v3/"></script>
{% endif %}

<script>
    /* global bootstrap */
    
document.addEventListener("DOMContentLoaded", function () {
    var toastElements = document.querySelectorAll(".toast");
    toastElements.forEach(function (toastEl) {
        var toast = new bootstrap.Toast(toastEl);
        toast.show();
    });

    if (document.getElementById("countdown-desktop")) {
        startCountdown(24, "countdown-desktop");
    }
});

function startCountdown(hours, elementId){
    let now = new Date();
    let resetTime = new Date(now);
    resetTime.setHours(now.getHours() + hours, 0, 0, 0);

    function updateCountdown() {
        let currentTime = new Date();
        let remainingTime = resetTime - currentTime;

        if (remainingTime <= 0) {
            resetTime.setHours(resetTime.getHours() + hours, 0, 0, 0);
            remainingTime = resetTime - currentTime;
        }

        let seconds = Math.floor((remainingTime / 1000) % 60);
        let minutes = Math.floor((remainingTime / 1000 / 60) % 60);
        let hoursLeft = Math.floor((remainingTime / 1000 / 60 / 60));

        let countdownElement = document.getElementById(elementId);
        if (countdownElement) {
            countdownElement.innerHTML = `Offer ends in: ${hoursLeft}h ` +
                             `${minutes}m ${seconds}s`;
        }

        setTimeout(updateCountdown, 1000);
    }

    updateCountdown();
}

document.addEventListener("DOMContentLoaded", function () {
    let lastScrollTop = 0;
    let scrollThrottle = false;
    let scrollDirection = 'up';
    let debounceTimer = null;
    const header = document.querySelector(".modern-header");

    // Much larger threshold gaps to create stable scroll zones
    const PROMO_HIDE_THRESHOLD = 120;
    const PROMO_SHOW_THRESHOLD = 60;  // Show promo when scrolling back up
    const SCROLLED_THRESHOLD = 50;
    const HEADER_HIDE_THRESHOLD = 300;
    const HEADER_SHOW_THRESHOLD = 200;
    const SCROLL_DELTA_THRESHOLD = 8; // Larger minimum scroll distance

    // Track current states to prevent unnecessary changes
    let isPromoHidden = false;
    let isScrolled = false;
    let isHeaderHidden = false;

    function handleScroll() {
        if (scrollThrottle) return;

        scrollThrottle = true;
        requestAnimationFrame(() => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollDelta = Math.abs(scrollTop - lastScrollTop);

            // Only process scroll if there's meaningful movement
            if (scrollDelta < SCROLL_DELTA_THRESHOLD) {
                scrollThrottle = false;
                return;
            }

            // Determine scroll direction
            scrollDirection = scrollTop > lastScrollTop ? 'down' : 'up';

            // Handle promo banner with larger hysteresis gap (only if not permanently closed)
            if (!header.classList.contains("promo-closed")) {
                if (!isPromoHidden && scrollTop > PROMO_HIDE_THRESHOLD) {
                    header.classList.add("hide-promo");
                    isPromoHidden = true;
                } else if (isPromoHidden && scrollTop < PROMO_SHOW_THRESHOLD) {
                    header.classList.remove("hide-promo");
                    isPromoHidden = false;
                }
            }

            // Add scrolled class with hysteresis
            if (!isScrolled && scrollTop > SCROLLED_THRESHOLD) {
                header.classList.add("scrolled");
                isScrolled = true;
            } else if (isScrolled && scrollTop < SCROLLED_THRESHOLD - 20) {
                header.classList.remove("scrolled");
                isScrolled = false;
            }

            // Hide/show header with much larger gaps
            if (!isHeaderHidden && scrollDirection === 'down' && scrollTop > HEADER_HIDE_THRESHOLD) {
                header.classList.add("hidden-header");
                isHeaderHidden = true;
            } else if (isHeaderHidden && (scrollDirection === 'up' || scrollTop < HEADER_SHOW_THRESHOLD)) {
                header.classList.remove("hidden-header");
                isHeaderHidden = false;
            }

            lastScrollTop = scrollTop;
            scrollThrottle = false;
        });
    }

    // Debounced scroll handler for even smoother performance
    function debouncedScroll() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(handleScroll, 8);
    }

    window.addEventListener("scroll", debouncedScroll, { passive: true });

    // Promo banner close functionality
    const promoCloseBtn = document.querySelector(".promo-close");

    // Check if promo was previously closed
    if (localStorage.getItem("promoBannerClosed") === "true") {
        header.classList.add("promo-closed");
    }

    if (promoCloseBtn) {
        promoCloseBtn.addEventListener("click", function(e) {
            e.preventDefault();
            e.stopPropagation();

            // Add closed class with animation
            header.classList.add("promo-closed");

            // Store the closed state
            localStorage.setItem("promoBannerClosed", "true");

            // Update scroll thresholds since promo is now permanently hidden
            isPromoHidden = true;
        });
    }

    // Enhanced mobile menu toggle with smooth animations
    const mobileMenuBtn = document.querySelector(".mobile-menu-btn");
    const mobileNavCollapse = document.querySelector(".mobile-nav-collapse");

    if (mobileMenuBtn && mobileNavCollapse) {
        mobileMenuBtn.addEventListener("click", function() {
            const isExpanded = this.getAttribute("aria-expanded") === "true";

            // Add slight delay for smooth hamburger animation
            if (!isExpanded) {
                setTimeout(() => {
                    mobileNavCollapse.classList.add("show");
                }, 50);
            } else {
                mobileNavCollapse.classList.remove("show");
            }
        });
    }
});
</script>
{% endblock %}

    </body>
</html>


 
