<script>
    document.addEventListener('DOMContentLoaded', () => {
        const updateStepperButtons = (itemId) => {
            const input = document.getElementById(`quantity-${itemId}`);
            if (!input) {
                return;
            }

            const min = parseInt(input.getAttribute('min') || '1', 10);
            const max = parseInt(input.getAttribute('max') || '99', 10);
            const currentValue = parseInt(input.value, 10);

            if (Number.isNaN(currentValue)) {
                return;
            }

            const disableDecrease = currentValue <= min;
            const disableIncrease = currentValue >= max;

            document
                .querySelectorAll(`[data-item_id='${itemId}'].decrease-btn`)
                .forEach((button) => {
                    button.disabled = disableDecrease;
                });

            document
                .querySelectorAll(`[data-item_id='${itemId}'].increase-btn`)
                .forEach((button) => {
                    button.disabled = disableIncrease;
                });
        };

        document.querySelectorAll('.qty_input').forEach((input) => {
            const itemId = input.dataset.item_id;
            if (!itemId) {
                return;
            }

            const handleChange = () => updateStepperButtons(itemId);
            updateStepperButtons(itemId);
            input.addEventListener('change', handleChange);
            input.addEventListener('input', handleChange);
        });

        const adjustQuantity = (button, direction) => {
            const inputGroup = button.closest('.input-group');
            if (!inputGroup) {
                return;
            }

            const input = inputGroup.querySelector('.qty_input');
            if (!input) {
                return;
            }

            const min = parseInt(input.getAttribute('min') || '1', 10);
            const max = parseInt(input.getAttribute('max') || '99', 10);
            const currentValue = parseInt(input.value, 10) || min;
            const nextValue = Math.min(Math.max(currentValue + direction, min), max);

            input.value = nextValue;

            const itemId = button.dataset.item_id;
            if (itemId) {
                updateStepperButtons(itemId);
            }

            button.blur();
        };

        document.querySelectorAll('.increase-btn').forEach((button) => {
            button.addEventListener('click', (event) => {
                event.preventDefault();
                adjustQuantity(button, 1);
            });
        });

        document.querySelectorAll('.decrease-btn').forEach((button) => {
            button.addEventListener('click', (event) => {
                event.preventDefault();
                adjustQuantity(button, -1);
            });
        });
    });
</script>
