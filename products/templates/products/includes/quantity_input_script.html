<!-- Load this script AFTER jQuery is loaded -->
<script>
    /* global $ */
    $(document).ready(function () {
        "use strict";

        function handleEnableDisable(itemId) {
            let input = $(`#quantity-${itemId}`);
            let currentValue = parseInt(input.val(), 10);
            if (isNaN(currentValue)) return;

            let minusDisabled = currentValue <= 1;
            let plusDisabled = currentValue >= 99;

            $(`[data-item_id='${itemId}'].decrease-btn`).prop("disabled", minusDisabled);
            $(`[data-item_id='${itemId}'].increase-btn`).prop("disabled", plusDisabled);
        }

        $(".qty_input").each(function () {
            let itemId = $(this).data("item_id");
            handleEnableDisable(itemId);
        });

        $(".qty_input").on("change", function () {
            let itemId = $(this).data("item_id");
            handleEnableDisable(itemId);
        });

        $(".increase-btn").on("click", function (e) {
            e.preventDefault();
            let input = $(this).closest(".input-group").find(".qty_input");
            let currentValue = parseInt(input.val(), 10) || 1;
            input.val(currentValue + 1);
            let itemId = $(this).data("item_id");
            handleEnableDisable(itemId);
            $(this).blur();
        });

        $(".decrease-btn").on("click", function (e) {
            e.preventDefault();
            let input = $(this).closest(".input-group").find(".qty_input");
            let currentValue = parseInt(input.val(), 10) || 1;
            if (currentValue > 1) {
                input.val(currentValue - 1);
            }
            let itemId = $(this).data("item_id");
            handleEnableDisable(itemId);
            $(this).blur();
        });
    });
</script>
